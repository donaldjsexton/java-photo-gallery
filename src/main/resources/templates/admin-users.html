<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Deliverable â€” User Admin</title>
        <link rel="stylesheet" th:href="@{/css/style.css}" />
    </head>
    <body class="page">
        <div class="bg-mesh"></div>
        <div class="shell app-shell">
            <header class="app-nav">
                <a class="brand" th:href="@{/dashboard}" aria-label="Deliverable dashboard">
                    <img
                        class="brand-logo brand-logo-mobile"
                        th:src="@{/img/logo.png}"
                        alt="Deliverable"
                        decoding="async"
                    />
                    <img
                        class="brand-logo brand-logo-desktop"
                        th:src="@{/img/logo-full.png}"
                        alt="Deliverable"
                        decoding="async"
                    />
                </a>
                <nav class="nav-actions" aria-label="Primary">
                    <a class="btn secondary" th:href="@{/dashboard}">
                        Back to dashboard
                    </a>
                </nav>
            </header>

            <main class="app-main">
                <div class="card" th:if="${message}">
                    <div class="muted small" th:text="${message}"></div>
                </div>
                <div class="card" th:if="${error}">
                    <div class="muted small" th:text="${error}"></div>
                </div>

                <section class="workbench">
                    <section class="column">
                        <article class="card">
                            <div class="card-head">
                                <div>
                                    <p class="eyebrow">Admin</p>
                                    <h2>Create user</h2>
                                    <p class="muted small">
                                        Users can sign in with username and password.
                                    </p>
                                </div>
                            </div>

                            <form
                                class="form stacked"
                                th:action="@{/admin/users}"
                                method="post"
                                th:object="${createForm}"
                            >
                                <input
                                    type="hidden"
                                    th:name="${_csrf.parameterName}"
                                    th:value="${_csrf.token}"
                                />
                                <label>
                                    <span>Username</span>
                                    <input
                                        type="text"
                                        th:field="*{username}"
                                        autocomplete="off"
                                        required
                                    />
                                    <small class="muted" th:if="${#fields.hasErrors('username')}"
                                        th:errors="*{username}"></small>
                                </label>
                                <label>
                                    <span>Email</span>
                                    <input
                                        type="email"
                                        th:field="*{email}"
                                        autocomplete="off"
                                        required
                                    />
                                    <small class="muted" th:if="${#fields.hasErrors('email')}"
                                        th:errors="*{email}"></small>
                                </label>
                                <label>
                                    <span>Password</span>
                                    <input
                                        type="password"
                                        th:field="*{password}"
                                        autocomplete="new-password"
                                        required
                                    />
                                    <small class="muted" th:if="${#fields.hasErrors('password')}"
                                        th:errors="*{password}"></small>
                                </label>
                                <label>
                                    <span>Role</span>
                                    <select th:field="*{role}">
                                        <option th:each="r : ${roles}" th:value="${r}" th:text="${r}"></option>
                                    </select>
                                </label>
                                <div class="actions">
                                    <button type="submit">Create user</button>
                                </div>
                            </form>
                        </article>
                    </section>

                    <section class="column main">
                        <article class="card">
                            <div class="card-head">
                                <div>
                                    <p class="eyebrow">Admin</p>
                                    <h2>Users</h2>
                                </div>
                            </div>

                            <div class="stack">
                                <div class="muted small" th:if="${users == null or users.isEmpty()}">
                                    No users found.
                                </div>
                                <div class="table" th:if="${users != null and !users.isEmpty()}">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Username</th>
                                                <th>Email</th>
                                                <th>Role</th>
                                                <th>Reset password</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="u : ${users}">
                                                <td th:text="${u.username}"></td>
                                                <td th:text="${u.email}"></td>
                                                <td th:text="${u.role}"></td>
                                                <td>
                                                    <form
                                                        th:action="@{/admin/users/{id}/password(id=${u.id})}"
                                                        method="post"
                                                        class="form inline"
                                                    >
                                                        <input
                                                            type="hidden"
                                                            th:name="${_csrf.parameterName}"
                                                            th:value="${_csrf.token}"
                                                        />
                                                        <input
                                                            type="password"
                                                            name="password"
                                                            placeholder="New password"
                                                            required
                                                        />
                                                        <button type="submit">Update</button>
                                                    </form>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <small class="muted" th:if="${#fields.hasErrors('passwordForm.password')}"
                                    th:errors="*{passwordForm.password}"></small>
                            </div>
                        </article>
                    </section>
                </section>
            </main>
        </div>
    </body>
</html>
