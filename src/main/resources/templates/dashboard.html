<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Deliverable — Dashboard</title>
        <link rel="stylesheet" th:href="@{/css/style.css}" />
    </head>
    <body class="page">
        <div class="bg-mesh"></div>
        <div class="shell app-shell">
            <header class="app-nav">
                <a class="brand" th:href="@{/dashboard}" aria-label="Deliverable dashboard">
                    <img
                        class="brand-logo brand-logo-mobile"
                        th:src="@{/img/logo.png}"
                        alt="Deliverable"
                        decoding="async"
                    />
                    <img
                        class="brand-logo brand-logo-desktop"
                        th:src="@{/img/logo-full.png}"
                        alt="Deliverable"
                        decoding="async"
                    />
                </a>
                <nav class="nav-actions" aria-label="Primary">
                    <form th:action="@{/logout}" method="post">
                        <input
                            type="hidden"
                            th:name="${_csrf.parameterName}"
                            th:value="${_csrf.token}"
                        />
                        <button type="submit" class="btn danger">
                            Sign out
                        </button>
                    </form>
                </nav>
            </header>

            <main class="app-main">
                <div class="card" th:if="${message != null}">
                    <div class="muted small" th:text="${message}"></div>
                </div>

                <div
                    class="workbench"
                    th:classappend="${albums != null and !albums.isEmpty()} ? 'no-onboarding' : ''"
                >
                <!-- Left sidebar -->
                <section class="column">
                    <article class="card">
                        <p class="eyebrow">Client Galleries</p>
                        <h2>Studio</h2>
                        <p class="muted small">
                            Start a new album, then open a gallery to add and
                            share photos.
                        </p>
                        <div class="stack">
                            <a class="chip clickable accent" th:href="@{/dashboard}">
                                My albums
                            </a>
                            <ul
                                class="album-list"
                                th:if="${albums != null and !albums.isEmpty()}"
                            >
                                <li th:each="a : ${albums}">
                                    <a
                                        class="album-link"
                                        th:href="@{/albums/{id}(id=${a.id})}"
                                    >
                                        <span
                                            class="strong small"
                                            th:text="${a.name}"
                                        ></span>
                                    </a>
                                </li>
                                <li>
                                    <a class="strong small" th:href="@{/flow/album}">
                                + New album
                            </a></li>
                            </ul>
                            <div
                                class="pager"
                                th:if="${albumPage != null and albumPage.totalPages > 1}"
                            >
                                <a
                                    class="chip ghost clickable"
                                    th:if="${albumPage.hasPrevious()}"
                                    th:href="@{/dashboard(page=${albumPage.number}, size=${albumPage.size}, categoryId=${currentCategoryId}, sort=${currentSort}, q=${searchQuery})}"
                                >
                                    Prev
                                </a>
                                <span
                                    class="muted small"
                                    th:text="'Page ' + (${albumPage.number + 1}) + ' of ' + ${albumPage.totalPages}"
                                ></span>
                                <a
                                    class="chip ghost clickable"
                                    th:if="${albumPage.hasNext()}"
                                    th:href="@{/dashboard(page=${albumPage.number + 2}, size=${albumPage.size}, categoryId=${currentCategoryId}, sort=${currentSort}, q=${searchQuery})}"
                                >
                                    Next
                                </a>
                            </div>
                        <div class="divider"></div>
                        <div class="stack small muted">
                            <div
                                th:text="${albumPage != null ? albumPage.totalElements : (albums != null ? #lists.size(albums) : 0)} + ' albums'"
                            ></div>
                        </div>
                    </article>

                    <article class="card" th:if="${categories != null}">
                        <div class="card-head">
                            <div>
                                <p class="eyebrow">Categories</p>
                                <h2>Browse by category</h2>
                            </div>
                        </div>
                        <div class="chip-cloud">
                            <a
                                class="chip ghost clickable"
                                th:classappend="${currentCategoryId == null} ? ' accent' : ''"
                                th:href="@{/dashboard(sort=${currentSort}, q=${searchQuery})}"
                            >
                                All
                            </a>
                            <a
                                class="chip ghost clickable"
                                th:classappend="${currentCategoryId != null and currentCategoryId == c.id} ? ' accent' : ''"
                                th:each="c : ${categories}"
                                th:text="${c.name}"
                                th:href="@{/dashboard(categoryId=${c.id}, sort=${currentSort}, q=${searchQuery})}"
                            ></a>
                        </div>
                    </article>
                </section>

                <!-- Main content -->
                <section class="column main">
                    <article class="card">
                        <div class="card-head">
                            <div>
                                <p class="eyebrow">Your albums</p>
                                <h2>Albums</h2>
                            </div>
                            <a class="pill ghost" th:href="@{/flow/album}">
                                + New album
                            </a>
                        </div>
                        <form class="form inline" method="get" th:action="@{/dashboard}">
                            <select name="categoryId">
                                <option value="">All categories</option>
                                <option
                                    th:each="c : ${categories}"
                                    th:value="${c.id}"
                                    th:text="${c.name}"
                                    th:selected="${currentCategoryId != null and currentCategoryId == c.id}"
                                ></option>
                            </select>
                            <select name="sort">
                                <option
                                    value="createdAt"
                                    th:selected="${currentSort == null or currentSort == 'createdAt'}"
                                >
                                    Newest first
                                </option>
                                <option
                                    value="title"
                                    th:selected="${currentSort != null and currentSort == 'title'}"
                                >
                                    A–Z
                                </option>
                            </select>
                            <input
                                type="search"
                                name="q"
                                placeholder="Search albums"
                                th:value="${searchQuery}"
                            />
                            <button type="submit">Filter</button>
                        </form>
                    </article>

                    <div class="gallery-grid">
                        <!-- Add tile -->
                        <a class="tile" th:href="@{/flow/album}">
                            <div class="thumb">
                                <div
                                    style="height: 200px; display: flex; align-items: center; justify-content: center; font-size: 48px; color: var(--muted);"
                                >
                                    +
                                </div>
                            </div>
                            <div class="tile-meta text-center">
                                <div class="strong small">
                                    Create a new album
                                </div>
                                <div class="muted small">
                                    Set up category and galleries
                                </div>
                            </div>
                        </a>

                        <!-- Existing albums -->
                        <a
                            class="tile"
                            th:each="a : ${albums}"
                            th:href="@{/albums/{id}(id=${a.id})}"
                        >
                            <div class="thumb">
                                <img
                                    th:if="${albumThumbnails != null and albumThumbnails[a.id] != null}"
                                    th:src="@{/photos/{id}/image(id=${albumThumbnails[a.id]})}"
                                    th:alt="${a.name}"
                                    onerror="this.style.display='none'"
                                />
                                <div
                                    th:if="${albumThumbnails == null or albumThumbnails[a.id] == null}"
                                    style="height: 200px; display: flex; align-items: center; justify-content: center; color: var(--muted);"
                                >
                                    <span
                                        class="pill ghost"
                                        th:text="${a.category != null ? a.category.name : 'Uncategorized'}"
                                    ></span>
                                </div>
                            </div>
                            <div class="tile-meta text-center">
                                <div class="strong small" th:text="${a.name}"></div>
                                <div
                                    class="muted small"
                                    th:text="${a.category != null ? a.category.name : 'Uncategorized'}"
                                ></div>
                                <div
                                    class="muted small"
                                    th:if="${a.createdAt != null}"
                                    th:text="${#temporals.format(a.createdAt, 'MMM d, yyyy')}"
                                ></div>
                            </div>
                        </a>
                    </div>

                    <article
                        class="card text-center muted"
                        th:if="${albums == null or albums.isEmpty()}"
                    >
                        No albums yet. Create your first album to get started.
                    </article>
                    <nav
                        class="pagination"
                        th:if="${albumPage != null and albumPage.totalPages > 1}"
                        aria-label="Album pagination"
                    >
                        <a
                            class="chip ghost clickable"
                            th:if="${albumPage.hasPrevious()}"
                            th:href="@{/dashboard(page=${albumPage.number}, size=${albumPage.size}, categoryId=${currentCategoryId}, sort=${currentSort}, q=${searchQuery})}"
                        >
                            Prev
                        </a>
                        <span
                            class="muted small"
                            th:text="'Page ' + (${albumPage.number + 1}) + ' of ' + ${albumPage.totalPages}"
                        ></span>
                        <a
                            class="chip ghost clickable"
                            th:if="${albumPage.hasNext()}"
                            th:href="@{/dashboard(page=${albumPage.number + 2}, size=${albumPage.size}, categoryId=${currentCategoryId}, sort=${currentSort}, q=${searchQuery})}"
                        >
                            Next
                        </a>
                    </nav>
                </section>

                <!-- Right column placeholder to preserve workbench rhythm -->
                <section
                    class="column"
                    th:if="${albums == null or albums.isEmpty()}"
                >
                    <article class="card gradient">
                        <p class="eyebrow">Ready to start?</p>
                        <h2>Create an album</h2>
                        <p class="muted small">
                            We’ll walk you through category, album, gallery, then
                            photos.
                        </p>
                        <a class="chip clickable accent" th:href="@{/flow/album}">
                            Start album setup
                        </a>
                    </article>
                </section>
                </div>
            </main>
        </div>
    </body>
</html>
